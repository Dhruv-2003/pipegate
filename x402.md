# x402 scheme integration

402 Payment Required Response

Payment Required response from the server

```json
{
  "x402Version": 1,
  "accepts": [
    {
      "scheme": "one-time", // or "stream" or other future schemes
      "network": "base",
      "amount": "0.001",
      "payTo": "0x..address",
      "asset": "0x..token_address",
      "resource": "example.com/api/resource",
      "description": "Access to example.com API resource", // Optional can be left empty
      "maxTimeoutSeconds": 300, // Optional can be left empty
      "extra": null
    }
  ],
  "error": "Payment Required"
}
```

`X-Payment` header from the client containing the payload should be sent

```json
{
  "x402Version": 1,
  "network": "base",
  "scheme": "one-time",
  "payload": object, // depending on the scheme
}
```

## One time payment

Payment Requirements

```json
{
  "scheme": "one-time",
  "network": "base",
  "amount": "0.001",
  "payTo": "0x..address",
  "asset": "0x..token_address",
  "resource": "example.com/api/resource",
  "description": "Access to example.com API resource", // Optional can be left empty
  "maxTimeoutSeconds": 300, // Optional can be left empty
  "extra": {
    "absWindowSeconds": 172800, // 48 hours , i.e.  payment must be within this window
    "sessionTTLSeconds": 3600, // 1 hour , i.e.  payment is valid for this long after first redemption
    "maxRedemptions": 5 // Optional can be left empty
  }
}
```

Scheme

```json
{
  "scheme": "one-time",
  "network_rpc_url": "https://base.rpc.thirdweb.com",
  "token_address": "0x..token_address",
  "recipient": "0x..address",
  "amount": "0.001"
}
```

`payload` from the client

```json
{
  "signature": "0x..sig",
  "tx_hash": "0x..hash"
}
```

## Streaming payments via Superfluid

Payment Requirements

```json
{
  "scheme": "stream",
  "network": "base",
  "amount": "2", // flow rate per month in this case
  "payTo": "0x..address",
  "asset": "0x..token_address",
  "resource": "example.com/api/resource",
  "description": "Access to example.com API resource", // Optional can be left empty
  "maxTimeoutSeconds": 300, // Optional can be left empty
  "extra": null
}
```

Scheme

```json
{
  "scheme": "stream",
  "network_rpc_url": "https://base.rpc.thirdweb.com",
  "token_address": "0x..token_address",
  "recipient": "0x..address",
  "amount": "2" // flow rate per month in this case
}
```

`payload` from the client

```json
{
  "signature": "0x..sig",
  "sender": "0x..address"
}
```

## Payment Channels ( TODO Work to be done on refining this )

Payment Requirements

```json
{
  "scheme": "channel",
  "network": "base",
  "amount": "0.001", // amount per request
  "payTo": "0x..address",
  "asset": "0x..token_address",
  "resource": "example.com/api/resource",
  "description": "Access to example.com API resource", // Optional can be left empty
  "maxTimeoutSeconds": 300, // Optional can be left empty
  "extra": paymentChannelState | null // if the channel is present in internal state, return the current values
}
```

Scheme

```json
{
  "scheme": "channel",
  "network_rpc_url": "https://base.rpc.thirdweb.com",
  "token_address": "0x..token_address",
  "recipient": "0x..address",
  "amount": "0.001" // amount per request
}
```

`payload` from the client

```json
{
  "signature": "0x..sig",
  "message": "0x..address",
  "paymentChannel": {
    "channelId": "string",
    "address": "string",
    "sender": "string",
    "recipient": "string",
    "balance": "string",
    "nonce": number,
    "expiration": number
  },
  "timestamp": number,
}
```
